<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§π‡§ø‡§∏‡§æ‡§¨ ‡§™‡•ç‡§∞‡•ã</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='%233a7bd5' d='M7 14.5c0 .83.67 1.5 1.5 1.5h6.06c.76 0 1.44-.55 1.44-1.44v-5.12c0-.89-.68-1.44-1.44-1.44H8.5C7.67 6.5 7 7.17 7 8v6.5zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z'/></svg>" type="image/svg+xml">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='%233a7bd5' d='M7 14.5c0 .83.67 1.5 1.5 1.5h6.06c.76 0 1.44-.55 1.44-1.44v-5.12c0-.89-.68-1.44-1.44-1.44H8.5C7.67 6.5 7 7.17 7 8v6.5zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z'/></svg>">
    
    <style>
        :root {
            --primary-color: #3a7bd5;
            --primary-gradient: linear-gradient(to right, #3a61bd, #00d2ff);
            --accent-color: #f5af19;
            --accent-gradient: linear-gradient(to right, #f12711, #f5af19);
            --danger-color: #e63946;
            --success-color: #2a9d8f;
            --whatsapp-color: #25D366;
            --wholesaler-color: #8a2be2;
            --bg-color: #f7f8fc;
            --card-bg: #ffffff;
            --text-dark: #2b2d42;
            --text-light: #8d99ae;
            --border-color: #e9ecef;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            --radius: 16px;
        }
        
        body.dark-mode {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-dark: #e0e0e0;
            --text-light: #888888;
            --border-color: #333333;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            --primary-gradient: linear-gradient(to right, #2a4a8c, #0088cc);
        }
        
        @import url('https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700&display=swap');
        
        #splash-screen { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: var(--primary-gradient); color: white; display: flex; align-items: center; justify-content: center; z-index: 9999; text-align: center; transition: opacity 0.8s ease-out, visibility 0.8s ease-out; opacity: 1; visibility: visible; }
        #splash-screen.hidden { opacity: 0; visibility: hidden; }
        .splash-content { animation: pop-in-splash 0.7s cubic-bezier(0.25, 0.8, 0.25, 1); transform-origin: center; }
        @keyframes pop-in-splash { 0% { transform: scale(0.5); opacity: 0; } 70% { transform: scale(1.05); opacity: 1; } 100% { transform: scale(1); opacity: 1; } }
        .splash-content h1 { font-size: 2.8rem; margin-bottom: 15px; text-shadow: 2px 2px 8px rgba(0,0,0,0.3); letter-spacing: 1px; }
        .splash-content p { font-size: 1.1rem; letter-spacing: 3px; opacity: 0.9; font-weight: 600; margin-top: 30px; text-shadow: 1px 1px 3px rgba(0,0,0,0.2); }
        .splash-logo { width: 120px; height: 120px; background: white; border-radius: 24px; display: flex; align-items: center; justify-content: center; margin: 0 auto 30px; box-shadow: 0 8px 25px rgba(0,0,0,0.2); animation: float 4s ease-in-out infinite; }
        .splash-logo svg { width: 70px; height: 70px; fill: var(--primary-color); }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-15px); } 100% { transform: translateY(0px); } }

        body { font-family: 'Manrope', sans-serif; background-color: var(--bg-color); color: var(--text-dark); margin: 0; transition: background-color 0.3s, color 0.3s; line-height: 1.6; padding-bottom: 80px; }
        .container { max-width: 1100px; margin: 0 auto; padding: 20px; }
        .main-header { display: flex; justify-content: space-between; align-items: center; padding: 25px 30px; margin-bottom: 30px; background: var(--primary-gradient); color: white; border-radius: var(--radius); text-align: center; box-shadow: 0 10px 20px -5px rgba(58,123,213,0.5); position: relative; overflow: hidden; }
        .main-header::before { content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%); transform: rotate(30deg); }
        .main-header h1 { margin: 0; font-size: 2.1rem; text-shadow: 1px 1px 3px rgba(0,0,0,0.2); position: relative; letter-spacing: 0.5px; }
        .theme-switch-wrapper { display: flex; align-items: center; position: relative; z-index: 2; }
        .theme-switch { display: inline-block; height: 34px; position: relative; width: 60px; }
        .theme-switch input { display:none; }
        .slider { background-color: #557ec9; bottom: 0; cursor: pointer; left: 0; position: absolute; right: 0; top: 0; transition: .4s; }
        .slider:before { background-color: #fff; bottom: 4px; content: ""; height: 26px; left: 4px; position: absolute; transition: .4s; width: 26px; }
        input:checked + .slider { background-color: #303136; }
        input:checked + .slider:before { transform: translateX(26px); }
        .slider.round { border-radius: 34px; }
        .slider.round:before { border-radius: 50%; }
        
        .page-section { display: none; }
        .page-section.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .dashboard-card { background: var(--card-bg); padding: 25px; border-radius: var(--radius); display: flex; align-items: center; gap: 20px; box-shadow: var(--shadow); transition: transform 0.3s, box-shadow 0.3s; }
        .dashboard-card:hover { transform: translateY(-8px); box-shadow: 0 12px 25px rgba(0,0,0,0.15); }
        .dashboard-card .icon { font-size: 2.5rem; padding: 15px; border-radius: 50%; background-color: var(--bg-color); display: flex; align-items: center; justify-content: center; min-width: 70px; min-height: 70px; }
        #totalCustomersIcon { color: var(--primary-color); background: rgba(58, 123, 213, 0.15); } 
        #totalDueIcon { color: var(--danger-color); background: rgba(230, 57, 70, 0.15); }
        #totalProductsIcon { color: var(--wholesaler-color); background: rgba(138, 43, 226, 0.15); }
        #totalStockValueIcon { color: var(--success-color); background: rgba(42, 157, 143, 0.15); }
        .dashboard-card .content { flex: 1; }
        .dashboard-card .title { font-size: 0.95rem; color: var(--text-light); margin-bottom: 5px; }
        .dashboard-card .value { font-size: 1.9rem; font-weight: 800; }
        
        .toolbar { display: flex; margin-bottom: 25px; position: relative; }
        #search-box, #product-search-box { flex-grow: 1; padding: 16px 20px 16px 55px; border: 1px solid var(--border-color); border-radius: var(--radius); font-size: 1.05rem; background: var(--card-bg); transition: all 0.3s; box-shadow: var(--shadow); }
        #search-box:focus, #product-search-box:focus { border-color: var(--primary-color); box-shadow: 0 0 0 4px rgba(58,123,213,0.2); outline: none; }
        .search-icon { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: var(--text-light); font-size: 1.2rem; }
        
        #customer-grid, #product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px; }
        .customer-card, .product-card { background: var(--card-bg); border-radius: var(--radius); box-shadow: var(--shadow); padding: 20px; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; display: flex; flex-direction: column; gap: 12px; }
        .customer-card { border-top: 4px solid var(--primary-color); }
        .product-card { border-top: 4px solid var(--wholesaler-color); }
        .customer-card:hover, .product-card:hover { transform: translateY(-8px); box-shadow: 0 12px 25px rgba(0,0,0,0.15); }
        
        .product-card-header { padding-bottom: 10px; border-bottom: 1px dashed var(--border-color); }
        .wholesaler-name { font-size: 1.2rem; font-weight: 700; color: var(--wholesaler-color); }
        .product-card-body .product-name { font-size: 1.5rem; font-weight: 700; margin: 0; }
        .product-card-body .product-unit { font-size: 0.9rem; color: var(--text-light); }
        .product-pricing-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; text-align: center; padding: 10px 0; }
        .product-pricing-grid div label { font-size: 0.8rem; color: var(--text-light); margin-bottom: 4px; display: block; }
        .product-pricing-grid div span { font-size: 1.2rem; font-weight: 700; }
        .product-card-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; padding-top: 12px; border-top: 1px dashed var(--border-color); }
        .stock-count { font-weight: 600; }
        .stock-count.low-stock { color: var(--danger-color); font-weight: 800; }
        .share-product-btn { background: none; border: none; cursor: pointer; color: var(--text-light); font-size: 1.5rem; padding: 5px; }
        .share-product-btn:hover { color: var(--primary-color); }

        .customer-card .name { font-size: 1.5rem; font-weight: 700; display: flex; align-items: center; gap: 10px; }
        .customer-card .name svg { width: 24px; height: 24px; fill: var(--text-light); }
        .customer-card .balance-label { font-size: 0.95rem; color: var(--text-light); margin-bottom: 5px; }
        .customer-card .balance-amount { font-size: 2.2rem; font-weight: 800; }
        .due-positive { color: var(--danger-color); } 
        .due-zero, .due-negative { color: var(--success-color); }
        .customer-card .last-transaction { margin-top: 10px; padding-top: 10px; border-top: 1px dashed var(--border-color); color: var(--text-light); font-size: 0.9rem; }
        .empty-state { text-align: center; color: var(--text-light); padding: 60px; grid-column: 1 / -1; background: var(--card-bg); border-radius: var(--radius); box-shadow: var(--shadow); }
        .empty-state svg { width: 80px; height: 80px; fill: var(--text-light); opacity: 0.3; margin-bottom: 20px; }
        
        .fab-container { position: fixed; bottom: 90px; right: 20px; display: flex; flex-direction: column-reverse; align-items: center; gap: 15px; z-index: 999; }
        .fab { width: 64px; height: 64px; color: white; border-radius: 50%; border: none; box-shadow: 0 6px 20px rgba(0,0,0,0.3); font-size: 32px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s; }
        #add-fab { background: var(--accent-gradient); }
        #add-product-fab { background: linear-gradient(to right, #6a11cb, #2575fc); }
        #voice-fab { background: var(--primary-gradient); font-size: 28px; }
        .fab:hover { transform: scale(1.1) rotate(15deg); box-shadow: 0 10px 25px rgba(0,0,0,0.35); }
        #voice-fab.listening { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(58, 123, 213, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(58, 123, 213, 0); } 100% { box-shadow: 0 0 0 0 rgba(58, 123, 213, 0); } }
        
        .modal { display: none; position: fixed; z-index: 1001; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(30, 30, 30, 0.5); backdrop-filter: blur(8px); align-items: center; justify-content: center; animation: fadeIn 0.3s; }
        .modal-content { background: var(--card-bg); border-radius: var(--radius); width: 90%; max-width: 550px; box-shadow: 0 15px 40px rgba(0,0,0,0.25); animation: pop-in 0.4s; overflow: hidden; display: flex; flex-direction: column; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes pop-in { from { transform: translateY(20px) scale(0.95); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }
        .modal-header { background: var(--primary-gradient); color: white; padding: 22px 25px; display: flex; justify-content: space-between; align-items: center; }
        .product-modal .modal-header { background: linear-gradient(to right, #6a11cb, #2575fc); }
        .modal-header h2 { margin:0; font-size: 1.5rem; }
        .close-btn { font-size: 2rem; color: white; opacity: 0.8; cursor: pointer; transition: all 0.2s; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 50%; }
        .close-btn:hover { opacity: 1; transform: rotate(90deg) scale(1.1); background: rgba(255,255,255,0.1); }
        .modal-body { padding: 25px; max-height: 70vh; overflow-y: auto; }
        .form-group { margin-bottom: 1.4rem; }
        .form-group-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.95rem; }
        input[type="text"], input[type="tel"], input[type="number"], textarea { width: 100%; padding: 15px; border: 1px solid var(--border-color); border-radius: 12px; font-size: 1rem; box-sizing: border-box; background-color: var(--bg-color); color: var(--text-dark); box-shadow: inset 0 2px 4px rgba(0,0,0,0.05); }
        input:focus, textarea:focus { border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(58,123,213,0.2); outline: none; }
        input:disabled { background-color: var(--border-color); cursor: not-allowed; }
        
        .btn { border-radius: 12px; font-weight: 600; padding: 16px 20px; text-transform: uppercase; letter-spacing: 0.5px; transition: all 0.2s; color: white; border: none; cursor: pointer; font-size: 0.95rem; display: inline-flex; align-items: center; justify-content: center; gap: 10px; }
        .btn svg { width: 20px; height: 20px; fill: white; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .btn-accent { background: var(--accent-gradient); }
        .btn-danger { background-color: var(--danger-color); }
        .btn-secondary { background-color: var(--text-light); }
        .btn-whatsapp { background-color: var(--whatsapp-color); }
        .btn-whatsapp:hover { background-color: #128C7E; }

        .profile-footer, .product-footer { display: grid; grid-template-columns: 1fr; gap: 10px; margin-top: 25px; }
        .form-buttons { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }
        
        #transactionHistory { list-style: none; padding: 0; margin-top: 15px; }
        #transactionHistory li.transaction-entry { display: flex; flex-direction: column; background: var(--bg-color); border: 1px solid var(--border-color); border-radius: 12px; padding: 15px; margin-bottom: 15px; position: relative; }
        .tx-entry-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 10px; border-bottom: 1px dashed var(--border-color); }
        .tx-entry-header h4 { margin: 0; color: var(--primary-color); font-size: 1.1rem; }
        .tx-entry-header .tx-date { font-size: 0.85rem; color: var(--text-light); }
        .tx-item-list { list-style: none; padding: 10px 0 10px 15px; margin: 0; }
        .tx-item-list li { padding: 4px 0; font-size: 0.95rem; display: flex; justify-content: space-between; }
        .tx-item-list .item-price-details { font-size: 0.85rem; color: var(--text-light); margin-left: 8px; }
        .tx-summary { font-weight: 700; margin-top: 10px; padding-top: 10px; border-top: 2px solid var(--border-color); text-align: right; font-size: 1.1rem; }
        .tx-summary.debit { color: var(--danger-color); }
        .tx-summary.credit { color: var(--success-color); }
        .transaction-entry .tx-delete { position: absolute; top: 10px; right: 10px; background: #fee2e2; color: #ef4444; border:none; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; cursor: pointer; font-size: 20px; }
        .transaction-entry .tx-delete:hover { background: #ef4444; color: white; transform: scale(1.1) rotate(90deg); }
        body.dark-mode .transaction-entry .tx-delete { background: #3a1a1a; color: #e63946; }
        body.dark-mode .transaction-entry .tx-delete:hover { background: #e63946; color: white; }

        .data-management { margin-top: 40px; text-align: center; padding: 25px; background: var(--card-bg); border-radius: var(--radius); box-shadow: var(--shadow); }
        .data-management h3 { margin-top: 0; margin-bottom: 15px; }
        #importBackupInput { display: none; }
        
        #toast-container { position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%); z-index: 2000; }
        .toast { padding: 12px 20px; border-radius: 50px; color: white; font-weight: 600; box-shadow: 0 5px 15px rgba(0,0,0,0.2); opacity: 0; transform: translateY(20px); transition: all 0.4s; }
        .toast.show { opacity: 1; transform: translateY(0); }
        .toast.success { background-color: var(--success-color); }
        .toast.error { background-color: var(--danger-color); }

        #confirmModal .modal-content { max-width: 400px; }
        #confirmModalBody { padding: 25px; text-align: center; }
        #confirmMessage { font-size: 1.1rem; margin-bottom: 25px; line-height: 1.6; }
        #confirmButtons { display: flex; justify-content: center; gap: 15px; }

        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; display: flex; justify-content: space-around; background-color: var(--card-bg); box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.08); z-index: 1000; border-top: 1px solid var(--border-color); }
        .bottom-nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 10px 0; cursor: pointer; color: var(--text-light); transition: color 0.3s; text-align: center; }
        .bottom-nav-item svg { width: 26px; height: 26px; fill: currentColor; margin-bottom: 4px; }
        .bottom-nav-item span { font-size: 0.8rem; font-weight: 600; }
        .bottom-nav-item.active { color: var(--primary-color); }
        
        #itemListContainer { background: var(--bg-color); border-radius: 12px; padding: 10px; min-height: 50px; border: 1px solid var(--border-color); max-height: 150px; overflow-y: auto; margin-bottom: 15px; }
        .item-in-list { display: flex; justify-content: space-between; align-items: center; background: var(--card-bg); padding: 8px 12px; border-radius: 8px; margin-bottom: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .item-in-list .item-details { flex-grow: 1; font-size: 0.95rem; }
        .item-in-list .item-price-details { color: var(--text-light); font-size: 0.85rem; }
        .remove-item-btn { background: none; border: none; color: var(--danger-color); font-size: 1.4rem; cursor: pointer; transition: transform 0.2s; padding: 5px; line-height: 1; }
        .remove-item-btn:hover { transform: scale(1.2); }
        #emptyListMsg { color: var(--text-light); text-align: center; padding: 20px 0; }
        .total-section { text-align: right; font-size: 1.3rem; font-weight: 700; margin: 15px 0; }

        @media (max-width: 768px) { .dashboard { grid-template-columns: 1fr; } .main-header { flex-direction: column; gap: 15px; } .main-header h1 { font-size: 1.8rem; } }
        @media (max-width: 480px) { #customer-grid, #product-grid { grid-template-columns: 1fr; } .modal-body { padding: 20px 15px; } .profile-footer, .product-footer { grid-template-columns: 1fr; } .fab-container { bottom: 90px; right: 15px; } }
    </style>
</head>
<body>

    <div id="splash-screen">
        <div class="splash-content">
            <div class="splash-logo"><svg viewBox="0 0 24 24"><path d="M7 14.5c0 .83.67 1.5 1.5 1.5h6.06c.76 0 1.44-.55 1.44-1.44v-5.12c0-.89-.68-1.44-1.44-1.44H8.5C7.67 6.5 7 7.17 7 8v6.5zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg></div>
            <h1>‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§π‡§ø‡§∏‡§æ‡§¨ ‡§™‡•ç‡§∞‡•ã</h1>
            <p>DEVELOPED BY ADITYA SINGH</p>
        </div>
    </div>
    
    <div class="container">
        <header class="main-header">
            <h1>‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§π‡§ø‡§∏‡§æ‡§¨ ‡§™‡•ç‡§∞‡•ã</h1>
            <div class="theme-switch-wrapper">
                <label class="theme-switch" for="theme-checkbox"><input type="checkbox" id="theme-checkbox" /><div class="slider round"></div></label>
            </div>
        </header>

        <!-- Home Page (Customers) -->
        <section id="home-page" class="page-section active">
            <section class="dashboard">
                <div class="dashboard-card">
                    <div id="totalCustomersIcon" class="icon">üë•</div>
                    <div class="content">
                        <div class="title">‡§ï‡•Å‡§≤ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï</div>
                        <div id="totalCustomers" class="value">0</div>
                    </div>
                </div>
                <div class="dashboard-card">
                    <div id="totalDueIcon" class="icon">üí∞</div>
                    <div class="content">
                        <div class="title">‡§ï‡•Å‡§≤ ‡§¨‡§ï‡§æ‡§Ø‡§æ</div>
                        <div id="totalDue" class="value">‚Çπ0</div>
                    </div>
                </div>
                <div class="dashboard-card">
                    <div id="totalProductsIcon" class="icon">üì¶</div>
                    <div class="content">
                        <div class="title">‡§ï‡•Å‡§≤ ‡§â‡§§‡•ç‡§™‡§æ‡§¶</div>
                        <div id="totalProducts" class="value">0</div>
                    </div>
                </div>
                <div class="dashboard-card">
                    <div id="totalStockValueIcon" class="icon">üíé</div>
                    <div class="content">
                        <div class="title">‡§∏‡•ç‡§ü‡•â‡§ï ‡§µ‡•à‡§≤‡•ç‡§Ø‡•Ç</div>
                        <div id="totalStockValue" class="value">‚Çπ0</div>
                    </div>
                </div>
            </section>

            <div class="toolbar">
                <input type="text" id="search-box" placeholder="‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ñ‡•ã‡§ú‡•á‡§Ç...">
                <div class="search-icon">üîç</div>
            </div>

            <div id="customer-grid">
                <div class="empty-state">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                    </svg>
                    <h3>‡§ï‡•ã‡§à ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</h3>
                    <p>‡§®‡§Ø‡§æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ú‡•ã‡§°‡§º‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è + ‡§¨‡§ü‡§® ‡§¶‡§¨‡§æ‡§è‡§Ç</p>
                </div>
            </div>
        </section>

        <!-- Products Page -->
        <section id="products-page" class="page-section">
            <div class="toolbar">
                <input type="text" id="product-search-box" placeholder="‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§ñ‡•ã‡§ú‡•á‡§Ç...">
                <div class="search-icon">üîç</div>
            </div>

            <div id="product-grid">
                <div class="empty-state">
                    <svg viewBox="0 0 24 24">
                        <path d="M7 18c0 1.1.9 2 2 2s2-.9 2-2-.9-2-2-2-2 .9-2 2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
                    </svg>
                    <h3>‡§ï‡•ã‡§à ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</h3>
                    <p>‡§®‡§Ø‡§æ ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§ú‡•ã‡§°‡§º‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è + ‡§¨‡§ü‡§® ‡§¶‡§¨‡§æ‡§è‡§Ç</p>
                </div>
            </div>
        </section>

        <!-- Data Management Section -->
        <section id="data-page" class="page-section">
            <div class="data-management">
                <h3>üîê ‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó</h3>
                <div id="passwordSetupSection" style="margin-bottom: 30px;">
                    <div class="form-group">
                        <label for="masterPassword">‡§®‡§Ø‡§æ ‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°</label>
                        <input type="password" id="masterPassword" placeholder="‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç" style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; font-size: 1rem;">
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§ï‡§®‡•ç‡§´‡§∞‡•ç‡§Æ ‡§ï‡§∞‡•á‡§Ç</label>
                        <input type="password" id="confirmPassword" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç" style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; font-size: 1rem;">
                    </div>
                    <button class="btn btn-accent" onclick="setMasterPassword()" style="width: 100%; margin-bottom: 10px;">üîí ‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç</button>
                </div>
                
                <div id="passwordChangeSection" style="display: none; margin-bottom: 30px;">
                    <div class="form-group">
                        <label for="currentPassword">‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°</label>
                        <input type="password" id="currentPassword" placeholder="‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç" style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; font-size: 1rem;">
                    </div>
                    <div class="form-group">
                        <label for="newPassword">‡§®‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°</label>
                        <input type="password" id="newPassword" placeholder="‡§®‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç" style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; font-size: 1rem;">
                    </div>
                    <div class="form-group">
                        <label for="confirmNewPassword">‡§®‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§ï‡§®‡•ç‡§´‡§∞‡•ç‡§Æ ‡§ï‡§∞‡•á‡§Ç</label>
                        <input type="password" id="confirmNewPassword" placeholder="‡§®‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç" style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; font-size: 1rem;">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <button class="btn btn-warning" onclick="changeMasterPassword()">üîÑ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¨‡§¶‡§≤‡•á‡§Ç</button>
                        <button class="btn btn-danger" onclick="removeMasterPassword()">üîì ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§π‡§ü‡§æ‡§è‡§Ç</button>
                    </div>
                </div>
                
                <div id="passwordStatus" style="margin-bottom: 30px; padding: 15px; border-radius: 8px; text-align: center; font-weight: 600;">
                    <span id="passwordStatusText">‡§ï‡•ã‡§à ‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§∏‡•á‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à</span>
                </div>

                <h3>‡§°‡•á‡§ü‡§æ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
                    <button class="btn btn-accent" onclick="exportData()">üì§ ‡§°‡•á‡§ü‡§æ ‡§è‡§ï‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('importBackupInput').click()">üì• ‡§°‡•á‡§ü‡§æ ‡§á‡§Æ‡•ç‡§™‡•ã‡§∞‡•ç‡§ü</button>
                </div>
                <input type="file" id="importBackupInput" accept=".json" onchange="importData(event)">
                <button class="btn btn-danger" onclick="clearAllData()" style="width: 100%; margin-top: 10px;">üóëÔ∏è ‡§∏‡§≠‡•Ä ‡§°‡•á‡§ü‡§æ ‡§∏‡§æ‡§´ ‡§ï‡§∞‡•á‡§Ç</button>
            </div>
        </section>
    </div>

    <!-- Customer Profile Modal -->
    <div id="customerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="customerModalTitle">‡§®‡§Ø‡§æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï</h2>
                <span class="close-btn" onclick="closeModal('customerModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="customerForm">
                    <div class="form-group">
                        <label for="customerName">‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ</label>
                        <input type="text" id="customerName" required>
                    </div>
                    <div class="form-group">
                        <label for="customerPhone">‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞</label>
                        <input type="tel" id="customerPhone">
                    </div>
                    <div class="form-group">
                        <label for="customerAddress">‡§™‡§§‡§æ</label>
                        <textarea id="customerAddress" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="initialBalance">‡§™‡•ç‡§∞‡§æ‡§∞‡§Ç‡§≠‡§ø‡§ï ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏</label>
                        <input type="number" id="initialBalance" value="0" step="0.01">
                    </div>
                </form>
                
                <div id="customerDetails" style="display: none;">
                    <div style="margin-bottom: 20px;">
                        <h3 id="profileCustomerName"></h3>
                        <p id="profileCustomerPhone"></p>
                        <p id="profileCustomerAddress"></p>
                        <div style="font-size: 1.3rem; font-weight: bold; margin: 10px 0;">
                            ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏: <span id="profileBalance"></span>
                        </div>
                    </div>

                    <!-- New Transaction Form -->
                    <div style="background: var(--bg-color); padding: 20px; border-radius: 12px; margin: 20px 0;">
                        <h4 style="text-align: center; margin-bottom: 25px; color: var(--primary-color);">‡§®‡§Ø‡§æ ‡§ñ‡§æ‡§§‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç</h4>
                        <form id="transactionForm">
                            <!-- Customer Name - Top -->
                            <div class="form-group">
                                <label for="newCustomerName" style="font-size: 1.1rem; color: var(--primary-color);">üì± ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ</label>
                                <input type="text" id="newCustomerName" placeholder="‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç" style="font-size: 1.1rem; font-weight: 600;" required>
                            </div>

                            <div class="form-group">
                                <label for="customerPhone" style="font-size: 1.1rem; color: var(--primary-color);">üìû ‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞</label>
                                <input type="tel" id="customerPhone" placeholder="‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç">
                            </div>
                            
                            <div class="form-group">
                                <label for="transactionType">‡§≤‡•á‡§®-‡§¶‡•á‡§® ‡§ï‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞</label>
                                <select id="transactionType" style="width: 100%; padding: 15px; border: 1px solid var(--border-color); border-radius: 12px; background: var(--card-bg); font-size: 1rem;">
                                    <option value="debit">‡§â‡§ß‡§æ‡§∞ ‡§¶‡§ø‡§Ø‡§æ (‡§°‡•á‡§¨‡§ø‡§ü)</option>
                                    <option value="credit">‡§™‡•à‡§∏‡•á ‡§Æ‡§ø‡§≤‡•á (‡§ï‡•ç‡§∞‡•á‡§°‡§ø‡§ü)</option>
                                </select>
                            </div>
                            
                            <!-- Items Section -->
                            <div class="form-group">
                                <label style="font-size: 1.1rem; color: var(--primary-color);">üõçÔ∏è ‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ï‡•Ä ‡§∏‡•Ç‡§ö‡•Ä</label>
                                <div id="itemListContainer">
                                    <div id="emptyListMsg">‡§ï‡•ã‡§à ‡§∏‡§æ‡§Æ‡§æ‡§® ‡§®‡§π‡•Ä‡§Ç ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ</div>
                                </div>
                                
                                <!-- Add Item Form - Improved Layout -->
                                <div style="background: var(--card-bg); padding: 15px; border-radius: 12px; margin-top: 15px; border: 2px dashed var(--border-color);">
                                    <div class="form-group" style="margin-bottom: 10px;">
                                        <label for="itemName" style="font-size: 0.9rem;">‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ</label>
                                        <input type="text" id="itemName" placeholder="‡§ú‡•à‡§∏‡•á: ‡§ö‡§æ‡§µ‡§≤, ‡§¶‡§æ‡§≤, ‡§§‡•á‡§≤..." style="font-size: 1rem;">
                                    </div>
                                    
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                                        <div>
                                            <label for="itemQuantity" style="font-size: 0.9rem;">‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ</label>
                                            <input type="number" id="itemQuantity" placeholder="‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ" min="1" value="1" style="font-size: 1rem;">
                                        </div>
                                        <div>
                                            <label for="itemPrice" style="font-size: 0.9rem;">‡§™‡•ç‡§∞‡§§‡§ø ‡§Ø‡•Ç‡§®‡§ø‡§ü ‡§¶‡§æ‡§Æ</label>
                                            <input type="number" id="itemPrice" placeholder="‚Çπ" step="0.01" style="font-size: 1rem;">
                                        </div>
                                    </div>
                                    
                                    <button type="button" onclick="addItemToList()" style="width: 100%; padding: 12px; background: var(--success-color); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 600;">
                                        ‚ûï ‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ú‡•ã‡§°‡§º‡•á‡§Ç (Enter ‡§¶‡§¨‡§æ‡§è‡§Ç)
                                    </button>
                                </div>
                            </div>

                            <!-- Total Section - Prominent -->
                            <div style="background: var(--primary-color); color: white; padding: 20px; border-radius: 12px; text-align: center; margin: 20px 0; font-size: 1.3rem; font-weight: 700;">
                                ‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø: ‚Çπ<span id="totalAmount">0</span>
                            </div>

                            <div class="form-group">
                                <label for="depositedAmount">‡§ú‡§Æ‡§æ ‡§∞‡§æ‡§∂‡§ø (‚Çπ)</label>
                                <input type="number" id="depositedAmount" placeholder="‡§ú‡§Æ‡§æ ‡§ï‡•Ä ‡§ó‡§à ‡§∞‡§æ‡§∂‡§ø ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç..." step="0.01" min="0" oninput="updateRemainingAmount()">
                                <small style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 4px; display: block;">‡§¨‡§ï‡§æ‡§Ø‡§æ ‡§∞‡§æ‡§∂‡§ø: <span id="remainingAmount">‚Çπ0.00</span></small>
                            </div>

                            <!-- Action Buttons -->
                            <div id="actionButtons" style="display: grid; grid-template-columns: 1fr; gap: 10px; margin-top: 20px;">
                                <button type="button" id="saveTransactionBtn" onclick="addTransaction()" class="btn btn-accent" style="width: 100%; font-size: 1.1rem; padding: 18px; display: none;">
                                    üíæ ‡§≤‡•á‡§®-‡§¶‡•á‡§® ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
                                </button>
                                <button type="button" id="createCustomerBtn" onclick="createCustomerAndTransaction()" class="btn btn-accent" style="width: 100%; font-size: 1.1rem; padding: 18px;">
                                    üíæ ‡§ñ‡§æ‡§§‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç ‡§î‡§∞ ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç
                                </button>
                                <button type="button" onclick="createAndShareWhatsApp()" class="btn btn-whatsapp" style="width: 100%; font-size: 1.1rem; padding: 18px;">
                                    üì± WhatsApp ‡§™‡§∞ ‡§∂‡•á‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Transaction History -->
                    <div>
                        <h4>‡§≤‡•á‡§®-‡§¶‡•á‡§® ‡§ï‡§æ ‡§á‡§§‡§ø‡§π‡§æ‡§∏</h4>
                        <ul id="transactionHistory"></ul>
                    </div>
                </div>

                <div class="profile-footer">
                    <div class="form-buttons">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('customerModal')">‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
                        <button type="submit" id="saveCustomerBtn" class="btn btn-accent" onclick="saveCustomer()">‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
                    </div>
                    
                    <div id="customerActions" style="display: none;">
                        <button class="btn btn-whatsapp" onclick="shareCustomerHistory()" style="width: 100%; margin: 10px 0;">
                            üì± WhatsApp ‡§∂‡•á‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç
                        </button>
                        <button class="btn btn-danger" onclick="deleteCustomer()" style="width: 100%;">
                            üóëÔ∏è ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§π‡§ü‡§æ‡§è‡§Ç
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="productModal" class="modal product-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="productModalTitle">‡§®‡§Ø‡§æ ‡§â‡§§‡•ç‡§™‡§æ‡§¶</h2>
                <span class="close-btn" onclick="closeModal('productModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="productForm">
                    <!-- Wholesaler Details - Top Priority -->
                    <div style="background: var(--primary-color); color: white; padding: 15px; border-radius: 12px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 15px 0; text-align: center;">üè™ ‡§π‡•ã‡§≤‡§∏‡•á‡§≤‡§∞ ‡§µ‡§ø‡§µ‡§∞‡§£</h4>
                        
                        <div class="form-group" style="margin-bottom: 10px;">
                            <label for="wholesalerName" style="color: white; font-weight: 600;">‡§π‡•ã‡§≤‡§∏‡•á‡§≤‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ</label>
                            <input type="text" id="wholesalerName" placeholder="‡§π‡•ã‡§≤‡§∏‡•á‡§≤‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç" required style="background: white; color: #333;">
                        </div>
                        
                        <div class="form-group-grid" style="grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div class="form-group">
                                <label for="wholesalerPhone" style="color: white; font-weight: 600;">‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞</label>
                                <input type="tel" id="wholesalerPhone" placeholder="‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞" style="background: white; color: #333;">
                            </div>
                            <div class="form-group">
                                <label for="wholesalerEmail" style="color: white; font-weight: 600;">‡§à‡§Æ‡•á‡§≤ ID</label>
                                <input type="email" id="wholesalerEmail" placeholder="‡§à‡§Æ‡•á‡§≤ ‡§™‡§§‡§æ" style="background: white; color: #333;">
                            </div>
                        </div>
                    </div>

                    <!-- Purchase Details -->
                    <div style="background: var(--card-bg); padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 2px solid var(--border-color);">
                        <h4 style="margin: 0 0 15px 0; color: var(--primary-color);">üõí ‡§ñ‡§∞‡•Ä‡§¶‡§æ‡§∞‡•Ä ‡§µ‡§ø‡§µ‡§∞‡§£</h4>
                        
                        <div class="form-group">
                            <label for="productName">‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ</label>
                            <input type="text" id="productName" placeholder="‡§ú‡•à‡§∏‡•á: ‡§ö‡§æ‡§µ‡§≤, ‡§¶‡§æ‡§≤, ‡§§‡•á‡§≤..." required>
                        </div>
                        
                        <div class="form-group-grid">
                            <div class="form-group">
                                <label for="productUnit">‡§Ø‡•Ç‡§®‡§ø‡§ü/‡§™‡•à‡§ï‡§ø‡§Ç‡§ó</label>
                                <select id="productUnit" style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; background: var(--card-bg);">
                                    <option value="‡§ï‡§ø‡§≤‡•ã">‡§ï‡§ø‡§≤‡•ã</option>
                                    <option value="‡§≤‡•Ä‡§ü‡§∞">‡§≤‡•Ä‡§ü‡§∞</option>
                                    <option value="‡§™‡•Ä‡§∏">‡§™‡•Ä‡§∏</option>
                                    <option value="‡§™‡•à‡§ï‡•á‡§ü">‡§™‡•à‡§ï‡•á‡§ü</option>
                                    <option value="‡§°‡§¨‡•ç‡§¨‡§æ">‡§°‡§¨‡•ç‡§¨‡§æ</option>
                                    <option value="‡§¶‡§∞‡•ç‡§ú‡§®">‡§¶‡§∞‡•ç‡§ú‡§®</option>
                                    <option value="‡§¨‡•ã‡§∞‡•Ä">‡§¨‡•ã‡§∞‡•Ä</option>
                                    <option value="‡§ï‡§æ‡§∞‡•ç‡§ü‡§®">‡§ï‡§æ‡§∞‡•ç‡§ü‡§®</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="purchaseQuantity">‡§ñ‡§∞‡•Ä‡§¶‡•Ä ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ</label>
                                <input type="number" id="purchaseQuantity" min="1" value="1" step="0.1" oninput="calculateProfit()">
                            </div>
                        </div>
                        
                        <div class="form-group-grid">
                            <div class="form-group">
                                <label for="buyingPrice">‡§ñ‡§∞‡•Ä‡§¶ ‡§¶‡§æ‡§Æ (‡§™‡•ç‡§∞‡§§‡§ø ‡§Ø‡•Ç‡§®‡§ø‡§ü)</label>
                                <input type="number" id="buyingPrice" step="0.01" min="0" placeholder="‚Çπ ‡§™‡•ç‡§∞‡§§‡§ø ‡§Ø‡•Ç‡§®‡§ø‡§ü" oninput="calculateProfit()">
                            </div>
                            <div class="form-group">
                                <label for="sellingPrice">‡§¨‡•á‡§ö‡§®‡•á ‡§ï‡§æ ‡§¶‡§æ‡§Æ (‡§™‡•ç‡§∞‡§§‡§ø ‡§Ø‡•Ç‡§®‡§ø‡§ü)</label>
                                <input type="number" id="sellingPrice" step="0.01" min="0" placeholder="‚Çπ ‡§™‡•ç‡§∞‡§§‡§ø ‡§Ø‡•Ç‡§®‡§ø‡§ü" oninput="calculateProfit()">
                            </div>
                        </div>
                    </div>

                    <!-- Profit Calculation Display -->
                    <div style="background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; padding: 15px; border-radius: 12px; margin-bottom: 20px; text-align: center;">
                        <h4 style="margin: 0 0 10px 0;">üí∞ ‡§≤‡§æ‡§≠ ‡§ó‡§£‡§®‡§æ</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; text-align: center;">
                            <div>
                                <div style="font-size: 0.9rem; opacity: 0.9;">‡§ï‡•Å‡§≤ ‡§ñ‡§∞‡•Ä‡§¶</div>
                                <div style="font-size: 1.2rem; font-weight: bold;">‚Çπ<span id="totalPurchase">0</span></div>
                            </div>
                            <div>
                                <div style="font-size: 0.9rem; opacity: 0.9;">‡§ï‡•Å‡§≤ ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä</div>
                                <div style="font-size: 1.2rem; font-weight: bold;">‚Çπ<span id="totalSelling">0</span></div>
                            </div>
                            <div>
                                <div style="font-size: 0.9rem; opacity: 0.9;">‡§ï‡•Å‡§≤ ‡§≤‡§æ‡§≠</div>
                                <div style="font-size: 1.3rem; font-weight: bold;">‚Çπ<span id="totalProfit">0</span></div>
                            </div>
                        </div>
                        <div style="margin-top: 10px; font-size: 1.1rem;">
                            ‡§≤‡§æ‡§≠ ‡§™‡•ç‡§∞‡§§‡§ø‡§∂‡§§: <span id="profitPercentage" style="font-weight: bold;">0%</span>
                        </div>
                    </div>

                    <!-- Add to Purchase List -->
                    <div style="background: var(--border-color); padding: 15px; border-radius: 12px; margin-bottom: 20px;">
                        <button type="button" onclick="addToPurchaseList()" style="width: 100%; padding: 12px; background: var(--success-color); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 600;">
                            ‚ûï ‡§ñ‡§∞‡•Ä‡§¶‡§æ‡§∞‡•Ä ‡§∏‡•Ç‡§ö‡•Ä ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
                        </button>
                    </div>

                    <!-- Purchase List Display -->
                    <div id="purchaseListContainer" style="background: var(--card-bg); padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 2px solid var(--border-color);">
                        <h4 style="margin: 0 0 15px 0; color: var(--primary-color);">üìã ‡§ñ‡§∞‡•Ä‡§¶‡§æ‡§∞‡•Ä ‡§∏‡•Ç‡§ö‡•Ä</h4>
                        <div id="purchaseItemsList">
                            <div style="text-align: center; color: var(--text-secondary); padding: 20px;">‡§ï‡•ã‡§à ‡§∏‡§æ‡§Æ‡§æ‡§® ‡§®‡§π‡•Ä‡§Ç ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ</div>
                        </div>
                    </div>

                    <!-- Total Purchase Summary -->
                    <div style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 15px; border-radius: 12px; margin-bottom: 20px; text-align: center;">
                        <h4 style="margin: 0 0 10px 0;">üí∞ ‡§ï‡•Å‡§≤ ‡§ñ‡§∞‡•Ä‡§¶‡§æ‡§∞‡•Ä ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <div style="font-size: 0.9rem; opacity: 0.9;">‡§ï‡•Å‡§≤ ‡§∏‡§æ‡§Æ‡§æ‡§®</div>
                                <div style="font-size: 1.2rem; font-weight: bold;"><span id="totalItems">0</span> ‡§Ü‡§á‡§ü‡§Æ</div>
                            </div>
                            <div>
                                <div style="font-size: 0.9rem; opacity: 0.9;">‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø</div>
                                <div style="font-size: 1.4rem; font-weight: bold;">‚Çπ<span id="grandTotal">0</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- Stock Management -->
                    <div class="form-group">
                        <label for="stockQuantity">‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§∏‡•ç‡§ü‡•â‡§ï ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ</label>
                        <input type="number" id="stockQuantity" min="0" value="0" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label for="mrpPrice">MRP (‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‡§ñ‡•Å‡§¶‡§∞‡§æ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø)</label>
                        <input type="number" id="mrpPrice" step="0.01" min="0" placeholder="‚Çπ MRP">
                    </div>
                </form>

                <div class="product-footer">
                    <div class="form-buttons">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('productModal')">‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
                        <button type="button" class="btn btn-success" onclick="completePurchaseOrder()" style="width: 100%; font-size: 1.1rem; padding: 18px; margin-bottom: 10px;">
                            ‚úÖ ‡§ñ‡§∞‡•Ä‡§¶‡§æ‡§∞‡•Ä ‡§™‡•Ç‡§∞‡•Ä ‡§ï‡§∞‡•á‡§Ç
                        </button>
                        <button type="submit" id="saveProductBtn" class="btn btn-accent" onclick="saveProduct()">üì¶ ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
                    </div>
                    
                    <div id="productActions" style="display: none;">
                        <button class="btn btn-danger" onclick="deleteProduct()" style="width: 100%; margin-top: 10px;">
                            üóëÔ∏è ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§π‡§ü‡§æ‡§è‡§Ç
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <div id="confirmModalBody">
                <div id="confirmMessage"></div>
                <div id="confirmButtons">
                    <button class="btn btn-secondary" onclick="closeModal('confirmModal')">‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
                    <button id="confirmYesBtn" class="btn btn-danger">‡§π‡§æ‡§Ç</button>
                </div>
            </div>
        </div>
    </div>

    <!-- FAB Buttons -->
    <div class="fab-container">
        <button id="voice-fab" class="fab" onclick="toggleVoiceRecognition()" title="Voice Input">üé§</button>
        <button id="add-product-fab" class="fab" onclick="openNewProductModal()" title="Add Product">üì¶</button>
        <button id="add-fab" class="fab" onclick="openCustomerModal()" title="Add Customer">+</button>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <div class="bottom-nav-item active" onclick="showPage('home')">
            <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
            <span>‡§π‡•ã‡§Æ</span>
        </div>
        <div class="bottom-nav-item" onclick="showPage('products')">
            <svg viewBox="0 0 24 24"><path d="M7 18c0 1.1.9 2 2 2s2-.9 2-2-.9-2-2-2-2 .9-2 2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>
            <span>‡§â‡§§‡•ç‡§™‡§æ‡§¶</span>
        </div>
        <div class="bottom-nav-item" onclick="showPage('data')">
            <svg viewBox="0 0 24 24"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/></svg>
            <span>‡§°‡•á‡§ü‡§æ</span>
        </div>
    </nav>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <script>
        // Global Variables
        let customers = JSON.parse(localStorage.getItem('customers')) || [];
        let products = JSON.parse(localStorage.getItem('products')) || [];
        let currentCustomer = null;
        let currentProduct = null;
        let currentItems = [];
        let isVoiceListening = false;

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            // Hide splash screen after 2 seconds
            setTimeout(() => {
                document.getElementById('splash-screen').classList.add('hidden');
            }, 2000);

            // Load saved theme
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
                document.getElementById('theme-checkbox').checked = true;
            }

            // Theme switch event
            document.getElementById('theme-checkbox').addEventListener('change', function() {
                document.body.classList.toggle('dark-mode');
                localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
            });

            // Search functionality
            document.getElementById('search-box').addEventListener('input', function() {
                filterCustomers(this.value);
            });

            document.getElementById('product-search-box').addEventListener('input', function() {
                filterProducts(this.value);
            });

            // Add keyboard event handlers for item entry
            document.addEventListener('keydown', function(event) {
                // Handle Enter key for adding items
                if (event.key === 'Enter') {
                    const activeElement = document.activeElement;
                    if (activeElement && ['itemName', 'itemQuantity', 'itemPrice'].includes(activeElement.id)) {
                        event.preventDefault();
                        addItemToList();
                    }
                }
            });

            // Load and display data
            displayCustomers();
            displayProducts();
            updateDashboard();
        });

        // Page Navigation
        function showPage(page) {
            // Hide all pages
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });

            // Show selected page
            document.getElementById(page + '-page').classList.add('active');

            // Update bottom nav
            document.querySelectorAll('.bottom-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
        }

        // Customer Functions
        function openCustomerModal(customer = null) {
            currentCustomer = customer;
            const modal = document.getElementById('customerModal');
            const title = document.getElementById('customerModalTitle');
            const form = document.getElementById('customerForm');
            const details = document.getElementById('customerDetails');
            const actions = document.getElementById('customerActions');
            const saveBtn = document.getElementById('saveCustomerBtn');

            if (customer) {
                // Edit existing customer
                title.textContent = '‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§µ‡§ø‡§µ‡§∞‡§£';
                form.style.display = 'none';
                details.style.display = 'block';
                actions.style.display = 'block';
                saveBtn.style.display = 'none';
                
                // Populate customer details
                document.getElementById('profileCustomerName').textContent = customer.name;
                document.getElementById('profileCustomerPhone').textContent = customer.phone || '‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ';
                document.getElementById('profileCustomerAddress').textContent = customer.address || '‡§™‡§§‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ';
                document.getElementById('profileBalance').textContent = `‚Çπ${customer.balance.toFixed(2)}`;
                document.getElementById('profileBalance').className = customer.balance > 0 ? 'due-positive' : customer.balance < 0 ? 'due-negative' : 'due-zero';
                
                // Load transaction history
                loadTransactionHistory(customer);
                
                // Pre-fill customer name and make it readonly for existing customer
                clearTransactionForm();
                document.getElementById('newCustomerName').value = customer.name;
                document.getElementById('newCustomerName').readOnly = true;
                document.getElementById('newCustomerName').style.backgroundColor = '#f5f5f5';
                document.getElementById('newCustomerName').style.color = '#666';
                
                if (customer.phone) {
                    document.getElementById('customerPhone').value = customer.phone;
                    document.getElementById('customerPhone').readOnly = true;
                    document.getElementById('customerPhone').style.backgroundColor = '#f5f5f5';
                    document.getElementById('customerPhone').style.color = '#666';
                }
                
                // Focus on item name instead for existing customers
                setTimeout(() => {
                    document.getElementById('itemName').focus();
                }, 300);
                
                // Show appropriate buttons for existing customer
                document.getElementById('saveTransactionBtn').style.display = 'block';
                document.getElementById('createCustomerBtn').style.display = 'none';
            } else {
                // Add new transaction form
                title.textContent = '‡§®‡§Ø‡§æ ‡§ñ‡§æ‡§§‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç';
                form.style.display = 'none';
                details.style.display = 'block';
                actions.style.display = 'none';
                saveBtn.style.display = 'none';
                
                // Show transaction form only
                showNewTransactionForm();
            }

            modal.style.display = 'flex';
        }

        function showNewTransactionForm() {
            // Clear any existing customer data display
            document.getElementById('profileCustomerName').textContent = '';
            document.getElementById('profileCustomerPhone').textContent = '';
            document.getElementById('profileCustomerAddress').textContent = '';
            document.getElementById('profileBalance').textContent = '';
            
            // Hide transaction history
            document.getElementById('transactionHistory').innerHTML = '';
            
            // Clear and show transaction form
            clearTransactionForm();
            
            // Make customer name and phone editable for new customers
            document.getElementById('newCustomerName').readOnly = false;
            document.getElementById('newCustomerName').style.backgroundColor = '';
            document.getElementById('newCustomerName').style.color = '';
            document.getElementById('customerPhone').readOnly = false;
            document.getElementById('customerPhone').style.backgroundColor = '';
            document.getElementById('customerPhone').style.color = '';
            
            // Set initial focus to customer name after modal opens
            setTimeout(() => {
                document.getElementById('newCustomerName').focus();
            }, 300);
            
            // Show appropriate buttons for new customer
            document.getElementById('saveTransactionBtn').style.display = 'none';
            document.getElementById('createCustomerBtn').style.display = 'block';
        }

        function saveCustomer() {
            const name = document.getElementById('customerName').value.trim();
            const phone = document.getElementById('customerPhone').value.trim();
            const address = document.getElementById('customerAddress').value.trim();
            const balance = parseFloat(document.getElementById('initialBalance').value) || 0;

            if (!name) {
                showToast('‡§ï‡•É‡§™‡§Ø‡§æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç', 'error');
                return;
            }

            const customer = {
                id: Date.now(),
                name,
                phone,
                address,
                balance,
                transactions: [],
                createdAt: new Date().toISOString()
            };

            customers.push(customer);
            localStorage.setItem('customers', JSON.stringify(customers));
            
            displayCustomers();
            updateDashboard();
            closeModal('customerModal');
            showToast('‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ', 'success');
        }

        function deleteCustomer() {
            if (!currentCustomer) return;

            showConfirmDialog('‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à ‡§á‡§∏ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡•ã ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?', () => {
                customers = customers.filter(c => c.id !== currentCustomer.id);
                localStorage.setItem('customers', JSON.stringify(customers));
                
                displayCustomers();
                updateDashboard();
                closeModal('customerModal');
                showToast('‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§π‡§ü‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ', 'success');
            });
        }

        function displayCustomers() {
            const grid = document.getElementById('customer-grid');
            
            if (customers.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                        </svg>
                        <h3>‡§ï‡•ã‡§à ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</h3>
                        <p>‡§®‡§Ø‡§æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ú‡•ã‡§°‡§º‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è + ‡§¨‡§ü‡§® ‡§¶‡§¨‡§æ‡§è‡§Ç</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = customers.map(customer => {
                const balanceClass = customer.balance > 0 ? 'due-positive' : customer.balance < 0 ? 'due-negative' : 'due-zero';
                const lastTransaction = customer.transactions && customer.transactions.length > 0 
                    ? customer.transactions[customer.transactions.length - 1] 
                    : null;

                return `
                    <div class="customer-card" onclick="openCustomerModal(${JSON.stringify(customer).replace(/"/g, '&quot;')})">
                        <div class="name">
                            <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/></svg>
                            ${customer.name}
                        </div>
                        <div class="balance-label">‡§¨‡§ï‡§æ‡§Ø‡§æ ‡§∞‡§æ‡§∂‡§ø</div>
                        <div class="balance-amount ${balanceClass}">‚Çπ${Math.abs(customer.balance).toFixed(2)}</div>
                        ${lastTransaction ? `
                            <div class="last-transaction">
                                ‡§Ü‡§ñ‡§ø‡§∞‡•Ä ‡§≤‡•á‡§®-‡§¶‡•á‡§®: ${new Date(lastTransaction.date).toLocaleDateString('hi-IN')}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function filterCustomers(searchTerm) {
            const filteredCustomers = customers.filter(customer => 
                customer.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                (customer.phone && customer.phone.includes(searchTerm))
            );

            const grid = document.getElementById('customer-grid');
            
            if (filteredCustomers.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24">
                            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                        </svg>
                        <h3>‡§ï‡•ã‡§à ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</h3>
                        <p>"${searchTerm}" ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ã‡§à ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filteredCustomers.map(customer => {
                const balanceClass = customer.balance > 0 ? 'due-positive' : customer.balance < 0 ? 'due-negative' : 'due-zero';
                const lastTransaction = customer.transactions && customer.transactions.length > 0 
                    ? customer.transactions[customer.transactions.length - 1] 
                    : null;

                return `
                    <div class="customer-card" onclick="openCustomerModal(${JSON.stringify(customer).replace(/"/g, '&quot;')})">
                        <div class="name">
                            <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/></svg>
                            ${customer.name}
                        </div>
                        <div class="balance-label">‡§¨‡§ï‡§æ‡§Ø‡§æ ‡§∞‡§æ‡§∂‡§ø</div>
                        <div class="balance-amount ${balanceClass}">‚Çπ${Math.abs(customer.balance).toFixed(2)}</div>
                        ${lastTransaction ? `
                            <div class="last-transaction">
                                ‡§Ü‡§ñ‡§ø‡§∞‡•Ä ‡§≤‡•á‡§®-‡§¶‡•á‡§®: ${new Date(lastTransaction.date).toLocaleDateString('hi-IN')}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // Transaction Functions
        function addItemToList() {
            const name = document.getElementById('itemName').value.trim();
            const quantity = parseInt(document.getElementById('itemQuantity').value) || 1;
            const price = parseFloat(document.getElementById('itemPrice').value) || 0;

            if (!name || price <= 0) {
                showToast('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§¶‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç', 'error');
                // Focus back to item name for correction
                document.getElementById('itemName').focus();
                return;
            }

            const item = {
                id: Date.now(),
                name,
                quantity,
                price,
                total: quantity * price
            };

            currentItems.push(item);
            updateItemsList();
            updateTotal();

            // Clear inputs and automatically focus back to item name
            document.getElementById('itemName').value = '';
            document.getElementById('itemQuantity').value = '1';
            document.getElementById('itemPrice').value = '';
            
            // Automatically focus on item name input for next entry
            setTimeout(() => {
                document.getElementById('itemName').focus();
            }, 100);
            
            showToast('‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ', 'success');
        }

        function removeItemFromList(itemId) {
            currentItems = currentItems.filter(item => item.id !== itemId);
            updateItemsList();
            updateTotal();
        }

        function updateItemsList() {
            const container = document.getElementById('itemListContainer');
            const emptyMsg = document.getElementById('emptyListMsg');

            if (currentItems.length === 0) {
                emptyMsg.style.display = 'block';
                container.querySelectorAll('.item-in-list').forEach(item => item.remove());
                return;
            }

            emptyMsg.style.display = 'none';
            
            // Remove existing items
            container.querySelectorAll('.item-in-list').forEach(item => item.remove());

            // Add current items
            currentItems.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item-in-list';
                itemDiv.innerHTML = `
                    <div class="item-details">
                        ${item.name} (${item.quantity} √ó ‚Çπ${item.price})
                        <div class="item-price-details">‡§ï‡•Å‡§≤: ‚Çπ${item.total.toFixed(2)}</div>
                    </div>
                    <button class="remove-item-btn" onclick="removeItemFromList(${item.id})">&times;</button>
                `;
                container.appendChild(itemDiv);
            });
        }

        function updateTotal() {
            const total = currentItems.reduce((sum, item) => sum + item.total, 0);
            document.getElementById('totalAmount').textContent = total.toFixed(2);
            updateRemainingAmount();
        }

        function updateRemainingAmount() {
            const total = currentItems.reduce((sum, item) => sum + item.total, 0);
            const deposited = parseFloat(document.getElementById('depositedAmount').value) || 0;
            const remaining = total - deposited;
            
            const remainingElement = document.getElementById('remainingAmount');
            if (remainingElement) {
                remainingElement.textContent = `‚Çπ${remaining.toFixed(2)}`;
                remainingElement.style.color = remaining > 0 ? '#e74c3c' : remaining < 0 ? '#27ae60' : '#666';
            }
        }

        function addTransaction() {
            if (!currentCustomer) {
                // If no current customer, create new customer with transaction
                createCustomerAndTransaction();
                return;
            }

            const type = document.getElementById('transactionType').value;
            const depositedAmount = parseFloat(document.getElementById('depositedAmount').value) || 0;
            const total = currentItems.reduce((sum, item) => sum + item.total, 0);

            if (currentItems.length === 0 || total <= 0) {
                showToast('‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ ‡§è‡§ï ‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ú‡•ã‡§°‡§º‡•á‡§Ç', 'error');
                return;
            }

            // Calculate remaining amount
            const remainingAmount = total - depositedAmount;

            const transaction = {
                id: Date.now(),
                type,
                items: [...currentItems],
                total,
                depositedAmount,
                remainingAmount,
                date: new Date().toISOString()
            };

            // Find customer in array and update
            const customerIndex = customers.findIndex(c => c.id === currentCustomer.id);
            if (customerIndex !== -1) {
                if (!customers[customerIndex].transactions) {
                    customers[customerIndex].transactions = [];
                }
                customers[customerIndex].transactions.push(transaction);
                
                // Update balance with remaining amount (not total)
                if (type === 'debit') {
                    customers[customerIndex].balance += remainingAmount;
                } else {
                    customers[customerIndex].balance -= remainingAmount;
                }

                // Update current customer reference
                currentCustomer = customers[customerIndex];
                
                localStorage.setItem('customers', JSON.stringify(customers));
                
                // Refresh displays
                loadTransactionHistory(currentCustomer);
                document.getElementById('profileBalance').textContent = `‚Çπ${currentCustomer.balance.toFixed(2)}`;
                document.getElementById('profileBalance').className = currentCustomer.balance > 0 ? 'due-positive' : currentCustomer.balance < 0 ? 'due-negative' : 'due-zero';
                
                displayCustomers();
                updateDashboard();
                clearTransactionForm();
                showToast('‡§≤‡•á‡§®-‡§¶‡•á‡§® ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ', 'success');
            }
        }

        // New function for creating customer and transaction from new form
        function createCustomerAndTransaction() {
            const customerName = document.getElementById('newCustomerName').value.trim();
            const customerPhone = document.getElementById('customerPhone').value.trim();
            const type = document.getElementById('transactionType').value;
            const depositedAmount = parseFloat(document.getElementById('depositedAmount').value) || 0;
            const total = currentItems.reduce((sum, item) => sum + item.total, 0);

            if (!customerName) {
                showToast('‡§ï‡•É‡§™‡§Ø‡§æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç', 'error');
                return;
            }

            if (currentItems.length === 0 || total <= 0) {
                showToast('‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ ‡§è‡§ï ‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ú‡•ã‡§°‡§º‡•á‡§Ç', 'error');
                return;
            }

            // Calculate remaining amount
            const remainingAmount = total - depositedAmount;

            // Create new customer
            const customer = {
                id: Date.now(),
                name: customerName,
                phone: customerPhone,
                address: '',
                balance: type === 'debit' ? remainingAmount : -remainingAmount,
                transactions: [],
                createdAt: new Date().toISOString()
            };

            // Create transaction
            const transaction = {
                id: Date.now() + 1,
                type,
                items: [...currentItems],
                total,
                depositedAmount,
                remainingAmount,
                date: new Date().toISOString()
            };

            // Add transaction to customer
            customer.transactions.push(transaction);

            // Add customer to array
            customers.push(customer);
            localStorage.setItem('customers', JSON.stringify(customers));

            // Update displays
            displayCustomers();
            updateDashboard();
            closeModal('customerModal');
            showToast('‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§î‡§∞ ‡§≤‡•á‡§®-‡§¶‡•á‡§® ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ', 'success');
        }

        // New function for creating and sharing via WhatsApp
        function createAndShareWhatsApp() {
            const customerName = document.getElementById('newCustomerName').value.trim();
            const customerPhone = document.getElementById('customerPhone').value.trim();
            const type = document.getElementById('transactionType').value;
            const depositedAmount = parseFloat(document.getElementById('depositedAmount').value) || 0;
            const total = currentItems.reduce((sum, item) => sum + item.total, 0);

            if (!customerName) {
                showToast('‡§ï‡•É‡§™‡§Ø‡§æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç', 'error');
                return;
            }

            if (currentItems.length === 0 || total <= 0) {
                showToast('‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ ‡§è‡§ï ‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ú‡•ã‡§°‡§º‡•á‡§Ç', 'error');
                return;
            }

            // Create customer and transaction first
            createCustomerAndTransaction();

            // Calculate remaining amount
            const remainingAmount = total - depositedAmount;

            // Generate WhatsApp message in the new format
            let message = `üßæ *‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§π‡§ø‡§∏‡§æ‡§¨ ‡§™‡•ç‡§∞‡•ã* üßæ\n`;
            message += `-----------------------------------\n`;
            message += `‡§ó‡•ç‡§∞‡§æ‡§π‡§ï: *${customerName}*\n`;
            message += `‡§§‡§æ‡§∞‡•Ä‡§ñ: ${new Date().toLocaleDateString('hi-IN')}\n`;
            message += `-----------------------------------\n\n`;
            
            message += `*‡§≤‡•á‡§®‡§¶‡•á‡§® ‡§ï‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£:*\n`;
            const typeText = type === 'debit' ? '‡§â‡§ß‡§æ‡§∞' : '‡§ú‡§Æ‡§æ';
            const today = new Date().toLocaleDateString('hi-IN');
            
            currentItems.forEach(item => {
                message += `üì¶ ${today}: ${item.name} - ‚Çπ${item.total.toFixed(0)} ${typeText}\n`;
            });
            
            if (depositedAmount > 0) {
                message += `üí∞ ${today}: ‡§ú‡§Æ‡§æ ‡§∞‡§æ‡§∂‡§ø - ‚Çπ${depositedAmount.toFixed(0)} ‡§ú‡§Æ‡§æ\n`;
            }
            
            message += `\n-----------------------------------\n`;
            message += `‡§ï‡•Å‡§≤ ‡§¨‡§ï‡§æ‡§Ø‡§æ: *‚Çπ${remainingAmount.toFixed(0)}*\n`;
            message += `-----------------------------------\n`;
            message += `üôè ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! üôè`;

            // Copy to clipboard and open WhatsApp without phone number
            navigator.clipboard.writeText(message).then(() => {
                showToast('‡§ñ‡§æ‡§§‡§æ ‡§ï‡•â‡§™‡•Ä ‡§π‡•ã ‡§ó‡§Ø‡§æ! WhatsApp ‡§Æ‡•á‡§Ç ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç', 'success');
            }).catch(() => {
                showToast('‡§ñ‡§æ‡§§‡§æ ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•à', 'success');
            });
            
            // Open WhatsApp without any phone number
            window.open('https://wa.me/', '_blank');
        }

        // Function to share existing customer's complete history
        function shareCustomerHistory() {
            if (!currentCustomer) return;

            // Generate complete history message
            let message = `üßæ *‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§π‡§ø‡§∏‡§æ‡§¨ ‡§™‡•ç‡§∞‡•ã* üßæ\n`;
            message += `-----------------------------------\n`;
            message += `‡§ó‡•ç‡§∞‡§æ‡§π‡§ï: *${currentCustomer.name}*\n`;
            message += `‡§§‡§æ‡§∞‡•Ä‡§ñ: ${new Date().toLocaleDateString('hi-IN')}\n`;
            message += `-----------------------------------\n\n`;
            
            message += `*‡§≤‡•á‡§®‡§¶‡•á‡§® ‡§ï‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£:*\n`;
            
            if (currentCustomer.transactions && currentCustomer.transactions.length > 0) {
                currentCustomer.transactions.forEach(transaction => {
                    const date = new Date(transaction.date).toLocaleDateString('hi-IN');
                    const typeText = transaction.type === 'debit' ? '‡§â‡§ß‡§æ‡§∞' : '‡§ú‡§Æ‡§æ';
                    
                    transaction.items.forEach(item => {
                        message += `üì¶ ${date}: ${item.name} - ‚Çπ${item.total.toFixed(0)} ${typeText}\n`;
                    });
                    
                    if (transaction.depositedAmount && transaction.depositedAmount > 0) {
                        message += `üí∞ ${date}: ‡§ú‡§Æ‡§æ ‡§∞‡§æ‡§∂‡§ø - ‚Çπ${transaction.depositedAmount.toFixed(0)} ‡§ú‡§Æ‡§æ\n`;
                    }
                });
            } else {
                message += `‡§ï‡•ã‡§à ‡§≤‡•á‡§®‡§¶‡•á‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ\n`;
            }
            
            message += `\n-----------------------------------\n`;
            message += `‡§ï‡•Å‡§≤ ‡§¨‡§ï‡§æ‡§Ø‡§æ: *‚Çπ${currentCustomer.balance.toFixed(0)}*\n`;
            message += `-----------------------------------\n`;
            message += `üôè ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! üôè`;

            // Copy to clipboard and open WhatsApp
            navigator.clipboard.writeText(message).then(() => {
                showToast('‡§ñ‡§æ‡§§‡§æ ‡§ï‡•â‡§™‡•Ä ‡§π‡•ã ‡§ó‡§Ø‡§æ! WhatsApp ‡§Æ‡•á‡§Ç ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç', 'success');
            }).catch(() => {
                showToast('‡§ñ‡§æ‡§§‡§æ ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•à', 'success');
            });
            
            // Open WhatsApp without any phone number
            window.open('https://wa.me/', '_blank');
        }

        function clearTransactionForm() {
            currentItems = [];
            updateItemsList();
            updateTotal();
            document.getElementById('itemName').value = '';
            document.getElementById('itemQuantity').value = '1';
            document.getElementById('itemPrice').value = '';
            document.getElementById('transactionType').value = 'debit';
            
            // Clear new customer form fields
            if (document.getElementById('newCustomerName')) {
                document.getElementById('newCustomerName').value = '';
            }
            if (document.getElementById('customerPhone')) {
                document.getElementById('customerPhone').value = '';
            }
            if (document.getElementById('depositedAmount')) {
                document.getElementById('depositedAmount').value = '';
            }
        }

        function loadTransactionHistory(customer) {
            const historyList = document.getElementById('transactionHistory');
            
            if (!customer.transactions || customer.transactions.length === 0) {
                historyList.innerHTML = '<li style="text-align: center; color: var(--text-light); padding: 20px;">‡§ï‡•ã‡§à ‡§≤‡•á‡§®-‡§¶‡•á‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</li>';
                return;
            }

            historyList.innerHTML = customer.transactions.slice().reverse().map(transaction => {
                const date = new Date(transaction.date).toLocaleDateString('hi-IN');
                const typeText = transaction.type === 'debit' ? '‡§â‡§ß‡§æ‡§∞ ‡§¶‡§ø‡§Ø‡§æ' : '‡§™‡•à‡§∏‡•á ‡§Æ‡§ø‡§≤‡•á';
                const summaryClass = transaction.type === 'debit' ? 'debit' : 'credit';
                
                return `
                    <li class="transaction-entry">
                        <button class="tx-delete" onclick="deleteTransaction(${customer.id}, ${transaction.id})">&times;</button>
                        <div class="tx-entry-header">
                            <h4>${typeText}</h4>
                            <span class="tx-date">${date}</span>
                        </div>
                        <ul class="tx-item-list">
                            ${transaction.items.map(item => `
                                <li>
                                    ${item.name}
                                    <span>‚Çπ${item.total.toFixed(2)}</span>
                                    <div class="item-price-details">${item.quantity} √ó ‚Çπ${item.price}</div>
                                </li>
                            `).join('')}
                        </ul>
                        ${transaction.note ? `<div style="margin-top: 10px; font-style: italic; color: var(--text-light);">${transaction.note}</div>` : ''}
                        <div class="tx-summary ${summaryClass}">‡§ï‡•Å‡§≤: ‚Çπ${transaction.total.toFixed(2)}</div>
                    </li>
                `;
            }).join('');
        }

        function deleteTransaction(customerId, transactionId) {
            showConfirmDialog('‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à ‡§á‡§∏ ‡§≤‡•á‡§®-‡§¶‡•á‡§® ‡§ï‡•ã ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?', () => {
                const customerIndex = customers.findIndex(c => c.id === customerId);
                if (customerIndex !== -1) {
                    const transactionIndex = customers[customerIndex].transactions.findIndex(t => t.id === transactionId);
                    if (transactionIndex !== -1) {
                        const transaction = customers[customerIndex].transactions[transactionIndex];
                        
                        // Reverse the balance change
                        if (transaction.type === 'debit') {
                            customers[customerIndex].balance -= transaction.total;
                        } else {
                            customers[customerIndex].balance += transaction.total;
                        }
                        
                        // Remove transaction
                        customers[customerIndex].transactions.splice(transactionIndex, 1);
                        
                        localStorage.setItem('customers', JSON.stringify(customers));
                        
                        // Update current customer reference
                        currentCustomer = customers[customerIndex];
                        
                        // Refresh displays
                        loadTransactionHistory(currentCustomer);
                        document.getElementById('profileBalance').textContent = `‚Çπ${currentCustomer.balance.toFixed(2)}`;
                        document.getElementById('profileBalance').className = currentCustomer.balance > 0 ? 'due-positive' : currentCustomer.balance < 0 ? 'due-negative' : 'due-zero';
                        
                        displayCustomers();
                        updateDashboard();
                        showToast('‡§≤‡•á‡§®-‡§¶‡•á‡§® ‡§π‡§ü‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ', 'success');
                    }
                }
            });
        }

        // Purchase List Management
        let currentPurchaseList = [];

        function addToPurchaseList() {
            const name = document.getElementById('productName').value.trim();
            const wholesaler = document.getElementById('wholesalerName').value.trim();
            const unit = document.getElementById('productUnit').value;
            const quantity = parseFloat(document.getElementById('purchaseQuantity').value) || 0;
            const buyingPrice = parseFloat(document.getElementById('buyingPrice').value) || 0;
            const sellingPrice = parseFloat(document.getElementById('sellingPrice').value) || 0;

            if (!name || !wholesaler || quantity <= 0 || buyingPrice <= 0) {
                showToast('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§´‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç', 'error');
                return;
            }

            const item = {
                id: Date.now(),
                name,
                wholesaler,
                unit,
                quantity,
                buyingPrice,
                sellingPrice,
                totalCost: quantity * buyingPrice,
                totalSelling: quantity * sellingPrice,
                profit: (quantity * sellingPrice) - (quantity * buyingPrice)
            };

            currentPurchaseList.push(item);
            updatePurchaseListDisplay();
            clearProductForm();
            showToast('‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ñ‡§∞‡•Ä‡§¶‡§æ‡§∞‡•Ä ‡§∏‡•Ç‡§ö‡•Ä ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ', 'success');
            
            // Focus back to product name for next entry
            setTimeout(() => {
                document.getElementById('productName').focus();
            }, 100);
        }

        function updatePurchaseListDisplay() {
            const container = document.getElementById('purchaseItemsList');
            
            if (currentPurchaseList.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 20px;">‡§ï‡•ã‡§à ‡§∏‡§æ‡§Æ‡§æ‡§® ‡§®‡§π‡•Ä‡§Ç ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ</div>';
                document.getElementById('totalItems').textContent = '0';
                document.getElementById('grandTotal').textContent = '0';
                return;
            }

            container.innerHTML = currentPurchaseList.map((item, index) => `
                <div style="background: white; border: 1px solid var(--border-color); border-radius: 8px; padding: 12px; margin-bottom: 8px;">
                    <div style="display: flex; justify-content: between; align-items: center;">
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--text-color);">${item.name}</div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary);">‡§π‡•ã‡§≤‡§∏‡•á‡§≤‡§∞: ${item.wholesaler}</div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary);">${item.quantity} ${item.unit} √ó ‚Çπ${item.buyingPrice} = ‚Çπ${item.totalCost.toFixed(2)}</div>
                        </div>
                        <div style="text-align: right;">
                            <button onclick="removeFromPurchaseList(${index})" style="background: #e74c3c; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 0.8rem;">√ó</button>
                            <div style="font-weight: 600; color: var(--primary-color); margin-top: 4px;">‚Çπ${item.totalCost.toFixed(2)}</div>
                        </div>
                    </div>
                </div>
            `).join('');

            // Update totals
            const totalItems = currentPurchaseList.length;
            const grandTotal = currentPurchaseList.reduce((sum, item) => sum + item.totalCost, 0);
            
            document.getElementById('totalItems').textContent = totalItems;
            document.getElementById('grandTotal').textContent = grandTotal.toFixed(2);
        }

        function removeFromPurchaseList(index) {
            currentPurchaseList.splice(index, 1);
            updatePurchaseListDisplay();
            showToast('‡§∏‡§æ‡§Æ‡§æ‡§® ‡§π‡§ü‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ', 'success');
        }

        function clearProductForm() {
            document.getElementById('productName').value = '';
            document.getElementById('purchaseQuantity').value = '1';
            document.getElementById('buyingPrice').value = '';
            document.getElementById('sellingPrice').value = '';
            calculateProfit();
        }

        function completePurchaseOrder() {
            if (currentPurchaseList.length === 0) {
                showToast('‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡§π‡§≤‡•á ‡§ï‡•Å‡§õ ‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ñ‡§∞‡•Ä‡§¶‡§æ‡§∞‡•Ä ‡§∏‡•Ç‡§ö‡•Ä ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç', 'error');
                return;
            }

            // Save all items to products array
            currentPurchaseList.forEach(item => {
                const product = {
                    id: Date.now() + Math.random(),
                    name: item.name,
                    wholesaler: item.wholesaler,
                    unit: item.unit,
                    purchaseQuantity: item.quantity,
                    stock: item.quantity, // Initial stock is same as purchase quantity
                    buyingPrice: item.buyingPrice,
                    sellingPrice: item.sellingPrice,
                    mrp: 0,
                    createdAt: new Date().toISOString()
                };
                products.push(product);
            });

            localStorage.setItem('products', JSON.stringify(products));
            
            // Clear purchase list
            currentPurchaseList = [];
            updatePurchaseListDisplay();
            
            displayProducts();
            updateDashboard();
            closeModal('productModal');
            showToast('‡§ñ‡§∞‡•Ä‡§¶‡§æ‡§∞‡•Ä ‡§™‡•Ç‡§∞‡•Ä ‡§π‡•ã ‡§ó‡§à! ‡§∏‡§≠‡•Ä ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§è', 'success');
        }

        // Product Functions
        function openNewProductModal() {
            // Check master password for new product creation
            if (!checkMasterPassword()) {
                return; // Access denied
            }
            openProductModal(null);
        }

        function openProductModal(product = null) {
            // Check master password if accessing existing wholesaler data
            if (product && !checkMasterPassword()) {
                return; // Access denied
            }
            
            currentProduct = product;
            const modal = document.getElementById('productModal');
            const title = document.getElementById('productModalTitle');
            const actions = document.getElementById('productActions');
            const saveBtn = document.getElementById('saveProductBtn');

            if (product) {
                // Edit existing product
                title.textContent = '‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç';
                actions.style.display = 'block';
                
                // Populate form
                document.getElementById('productName').value = product.name;
                document.getElementById('wholesalerName').value = product.wholesaler;
                document.getElementById('wholesalerPhone').value = product.wholesalerPhone || '';
                document.getElementById('wholesalerEmail').value = product.wholesalerEmail || '';
                document.getElementById('productUnit').value = product.unit || '‡§ï‡§ø‡§≤‡•ã';
                document.getElementById('purchaseQuantity').value = product.purchaseQuantity || 1;
                document.getElementById('stockQuantity').value = product.stock || 0;
                document.getElementById('buyingPrice').value = product.buyingPrice || 0;
                document.getElementById('sellingPrice').value = product.sellingPrice || 0;
                document.getElementById('mrpPrice').value = product.mrp || 0;
            } else {
                // Add new product
                title.textContent = '‡§®‡§Ø‡§æ ‡§π‡•ã‡§≤‡§∏‡•á‡§≤‡§∞ ‡§∏‡•á ‡§ñ‡§∞‡•Ä‡§¶‡§æ‡§∞‡•Ä';
                actions.style.display = 'none';
                
                // Clear form
                document.getElementById('productForm').reset();
                document.getElementById('stockQuantity').value = '0';
                document.getElementById('purchaseQuantity').value = '1';
                document.getElementById('productUnit').value = '‡§ï‡§ø‡§≤‡•ã';
                
                // Clear purchase list for new session
                currentPurchaseList = [];
                updatePurchaseListDisplay();
                
                // Set focus to wholesaler name
                setTimeout(() => {
                    document.getElementById('wholesalerName').focus();
                }, 300);
            }

            // Reset profit calculation
            calculateProfit();
            modal.style.display = 'flex';
        }

        function calculateProfit() {
            const quantity = parseFloat(document.getElementById('purchaseQuantity').value) || 0;
            const buyingPrice = parseFloat(document.getElementById('buyingPrice').value) || 0;
            const sellingPrice = parseFloat(document.getElementById('sellingPrice').value) || 0;
            
            const totalPurchase = quantity * buyingPrice;
            const totalSelling = quantity * sellingPrice;
            const totalProfit = totalSelling - totalPurchase;
            const profitPercentage = buyingPrice > 0 ? ((totalProfit / totalPurchase) * 100) : 0;
            
            // Update display
            if (document.getElementById('totalPurchase')) {
                document.getElementById('totalPurchase').textContent = totalPurchase.toFixed(2);
                document.getElementById('totalSelling').textContent = totalSelling.toFixed(2);
                document.getElementById('totalProfit').textContent = totalProfit.toFixed(2);
                document.getElementById('profitPercentage').textContent = profitPercentage.toFixed(1) + '%';
                
                // Color coding for profit
                const profitElement = document.getElementById('totalProfit');
                if (totalProfit > 0) {
                    profitElement.style.color = '#27ae60';
                } else if (totalProfit < 0) {
                    profitElement.style.color = '#e74c3c';
                } else {
                    profitElement.style.color = 'white';
                }
            }
        }

        function saveProduct() {
            const name = document.getElementById('productName').value.trim();
            const wholesaler = document.getElementById('wholesalerName').value.trim();
            const wholesalerPhone = document.getElementById('wholesalerPhone').value.trim();
            const wholesalerEmail = document.getElementById('wholesalerEmail').value.trim();
            const unit = document.getElementById('productUnit').value.trim();
            const purchaseQuantity = parseFloat(document.getElementById('purchaseQuantity').value) || 1;
            const stock = parseFloat(document.getElementById('stockQuantity').value) || 0;
            const buyingPrice = parseFloat(document.getElementById('buyingPrice').value) || 0;
            const sellingPrice = parseFloat(document.getElementById('sellingPrice').value) || 0;
            const mrp = parseFloat(document.getElementById('mrpPrice').value) || 0;

            if (!name || !wholesaler) {
                showToast('‡§ï‡•É‡§™‡§Ø‡§æ ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§π‡•ã‡§≤‡§∏‡•á‡§≤‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç', 'error');
                return;
            }

            if (currentProduct) {
                // Edit existing product
                const productIndex = products.findIndex(p => p.id === currentProduct.id);
                if (productIndex !== -1) {
                    products[productIndex] = {
                        ...products[productIndex],
                        name,
                        wholesaler,
                        wholesalerPhone,
                        wholesalerEmail,
                        unit,
                        purchaseQuantity,
                        stock,
                        buyingPrice,
                        sellingPrice,
                        mrp
                    };
                }
            } else {
                // Add new product
                const product = {
                    id: Date.now(),
                    name,
                    wholesaler,
                    wholesalerPhone,
                    wholesalerEmail,
                    unit,
                    purchaseQuantity,
                    stock,
                    buyingPrice,
                    sellingPrice,
                    mrp,
                    createdAt: new Date().toISOString()
                };
                products.push(product);
            }

            localStorage.setItem('products', JSON.stringify(products));
            
            displayProducts();
            updateDashboard();
            closeModal('productModal');
            showToast(currentProduct ? '‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ' : '‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ', 'success');
        }

        function deleteProduct() {
            if (!currentProduct) return;

            showConfirmDialog('‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à ‡§á‡§∏ ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§ï‡•ã ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?', () => {
                products = products.filter(p => p.id !== currentProduct.id);
                localStorage.setItem('products', JSON.stringify(products));
                
                displayProducts();
                updateDashboard();
                closeModal('productModal');
                showToast('‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§π‡§ü‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ', 'success');
            });
        }

        function displayProducts() {
            const grid = document.getElementById('product-grid');
            
            if (products.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24">
                            <path d="M7 18c0 1.1.9 2 2 2s2-.9 2-2-.9-2-2-2-2 .9-2 2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
                        </svg>
                        <h3>‡§ï‡•ã‡§à ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</h3>
                        <p>‡§®‡§Ø‡§æ ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§ú‡•ã‡§°‡§º‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è + ‡§¨‡§ü‡§® ‡§¶‡§¨‡§æ‡§è‡§Ç</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = products.map(product => {
                const stockClass = product.stock <= 5 ? 'low-stock' : '';
                
                return `
                    <div class="product-card" onclick="openProductModal(${JSON.stringify(product).replace(/"/g, '&quot;')})">
                        <div class="product-card-header">
                            <div class="wholesaler-name">${product.wholesaler}</div>
                        </div>
                        <div class="product-card-body">
                            <div class="product-name">${product.name}</div>
                            ${product.unit ? `<div class="product-unit">${product.unit}</div>` : ''}
                        </div>
                        <div class="product-pricing-grid">
                            <div>
                                <label>‡§ñ‡§∞‡•Ä‡§¶</label>
                                <span>‚Çπ${product.buyingPrice ? product.buyingPrice.toFixed(2) : '0.00'}</span>
                            </div>
                            <div>
                                <label>‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä</label>
                                <span>‚Çπ${product.sellingPrice ? product.sellingPrice.toFixed(2) : '0.00'}</span>
                            </div>
                            <div>
                                <label>MRP</label>
                                <span>‚Çπ${product.mrp ? product.mrp.toFixed(2) : '0.00'}</span>
                            </div>
                        </div>
                        <div class="product-card-footer">
                            <div class="stock-count ${stockClass}">
                                ‡§∏‡•ç‡§ü‡•â‡§ï: ${product.stock || 0}
                            </div>
                            <button class="share-product-btn" onclick="shareProduct(event, ${JSON.stringify(product).replace(/"/g, '&quot;')})">üì§</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterProducts(searchTerm) {
            const filteredProducts = products.filter(product => 
                product.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                product.wholesaler.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const grid = document.getElementById('product-grid');
            
            if (filteredProducts.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24">
                            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                        </svg>
                        <h3>‡§ï‡•ã‡§à ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</h3>
                        <p>"${searchTerm}" ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ã‡§à ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filteredProducts.map(product => {
                const stockClass = product.stock <= 5 ? 'low-stock' : '';
                
                return `
                    <div class="product-card" onclick="openProductModal(${JSON.stringify(product).replace(/"/g, '&quot;')})">
                        <div class="product-card-header">
                            <div class="wholesaler-name">${product.wholesaler}</div>
                        </div>
                        <div class="product-card-body">
                            <div class="product-name">${product.name}</div>
                            ${product.unit ? `<div class="product-unit">${product.unit}</div>` : ''}
                        </div>
                        <div class="product-pricing-grid">
                            <div>
                                <label>‡§ñ‡§∞‡•Ä‡§¶</label>
                                <span>‚Çπ${product.buyingPrice ? product.buyingPrice.toFixed(2) : '0.00'}</span>
                            </div>
                            <div>
                                <label>‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä</label>
                                <span>‚Çπ${product.sellingPrice ? product.sellingPrice.toFixed(2) : '0.00'}</span>
                            </div>
                            <div>
                                <label>MRP</label>
                                <span>‚Çπ${product.mrp ? product.mrp.toFixed(2) : '0.00'}</span>
                            </div>
                        </div>
                        <div class="product-card-footer">
                            <div class="stock-count ${stockClass}">
                                ‡§∏‡•ç‡§ü‡•â‡§ï: ${product.stock || 0}
                            </div>
                            <button class="share-product-btn" onclick="shareProduct(event, ${JSON.stringify(product).replace(/"/g, '&quot;')})">üì§</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function shareProduct(event, product) {
            event.stopPropagation();
            
            const message = `üõçÔ∏è *${product.name}*\n\n` +
                           `üè™ ‡§π‡•ã‡§≤‡§∏‡•á‡§≤‡§∞: ${product.wholesaler}\n` +
                           `üí∞ ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§¶‡§æ‡§Æ: ‚Çπ${product.sellingPrice ? product.sellingPrice.toFixed(2) : '0.00'}\n` +
                           `üè∑Ô∏è MRP: ‚Çπ${product.mrp ? product.mrp.toFixed(2) : '0.00'}\n` +
                           `üì¶ ‡§∏‡•ç‡§ü‡•â‡§ï: ${product.stock || 0}\n\n` +
                           `‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§π‡§ø‡§∏‡§æ‡§¨ ‡§™‡•ç‡§∞‡•ã ‡§∏‡•á ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ`;

            if (navigator.share) {
                navigator.share({
                    title: product.name,
                    text: message
                });
            } else {
                // Fallback to WhatsApp
                const url = `https://wa.me/?text=${encodeURIComponent(message)}`;
                window.open(url, '_blank');
            }
        }

        // Dashboard Functions
        function updateDashboard() {
            // Total customers
            document.getElementById('totalCustomers').textContent = customers.length;

            // Total due amount
            const totalDue = customers.reduce((sum, customer) => {
                return sum + (customer.balance > 0 ? customer.balance : 0);
            }, 0);
            document.getElementById('totalDue').textContent = `‚Çπ${totalDue.toFixed(2)}`;

            // Total products
            document.getElementById('totalProducts').textContent = products.length;

            // Total stock value
            const totalStockValue = products.reduce((sum, product) => {
                return sum + ((product.stock || 0) * (product.buyingPrice || 0));
            }, 0);
            document.getElementById('totalStockValue').textContent = `‚Çπ${totalStockValue.toFixed(2)}`;
        }

        // WhatsApp Integration
        function sendWhatsApp() {
            if (!currentCustomer) return;

            const balance = currentCustomer.balance;
            let message = `üìä *‡§ñ‡§æ‡§§‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£*\n\n`;
            message += `üë§ ‡§®‡§æ‡§Æ: ${currentCustomer.name}\n`;
            
            if (balance > 0) {
                message += `üí∞ ‡§¨‡§ï‡§æ‡§Ø‡§æ ‡§∞‡§æ‡§∂‡§ø: ‚Çπ${balance.toFixed(2)}\n\n`;
                message += `‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡§æ ‡§¨‡§ï‡§æ‡§Ø‡§æ ‡§ö‡•Å‡§ï‡§§‡§æ ‡§ï‡§∞‡•á‡§Ç‡•§\n\n`;
            } else if (balance < 0) {
                message += `‚úÖ ‡§Ü‡§™‡§ï‡§æ ‡§ñ‡§æ‡§§‡§æ ‚Çπ${Math.abs(balance).toFixed(2)} ‡§ï‡§æ ‡§ï‡•ç‡§∞‡•á‡§°‡§ø‡§ü ‡§π‡•à\n\n`;
            } else {
                message += `‚úÖ ‡§Ü‡§™‡§ï‡§æ ‡§ñ‡§æ‡§§‡§æ ‡§ï‡•ç‡§≤‡§ø‡§Ø‡§∞ ‡§π‡•à\n\n`;
            }

            message += `‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§π‡§ø‡§∏‡§æ‡§¨ ‡§™‡•ç‡§∞‡•ã ‡§∏‡•á ‡§≠‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ`;

            const phone = currentCustomer.phone ? currentCustomer.phone.replace(/\D/g, '') : '';
            const url = phone 
                ? `https://wa.me/91${phone}?text=${encodeURIComponent(message)}`
                : `https://wa.me/?text=${encodeURIComponent(message)}`;
            
            window.open(url, '_blank');
        }

        // Voice Recognition
        function toggleVoiceRecognition() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                showToast('Voice recognition not supported', 'error');
                return;
            }

            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            const voiceBtn = document.getElementById('voice-fab');

            if (isVoiceListening) {
                recognition.stop();
                voiceBtn.classList.remove('listening');
                isVoiceListening = false;
                return;
            }

            recognition.lang = 'hi-IN';
            recognition.continuous = false;
            recognition.interimResults = false;

            recognition.onstart = function() {
                isVoiceListening = true;
                voiceBtn.classList.add('listening');
                showToast('‡§∏‡•Å‡§® ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Ç...', 'success');
            };

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                showToast(`‡§∏‡•Å‡§®‡§æ: ${transcript}`, 'success');
                
                // Simple voice commands
                if (transcript.includes('‡§ó‡•ç‡§∞‡§æ‡§π‡§ï') && transcript.includes('‡§ú‡•ã‡§°‡§º')) {
                    openCustomerModal();
                } else if (transcript.includes('‡§â‡§§‡•ç‡§™‡§æ‡§¶') && transcript.includes('‡§ú‡•ã‡§°‡§º')) {
                    openProductModal();
                }
            };

            recognition.onerror = function(event) {
                showToast('Voice recognition error', 'error');
                voiceBtn.classList.remove('listening');
                isVoiceListening = false;
            };

            recognition.onend = function() {
                voiceBtn.classList.remove('listening');
                isVoiceListening = false;
            };

            recognition.start();
        }

        // Data Management
        function exportData() {
            const data = {
                customers,
                products,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };

            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `hisab-pro-backup-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('‡§°‡•á‡§ü‡§æ ‡§è‡§ï‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§π‡•ã ‡§ó‡§Ø‡§æ', 'success');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.customers && data.products) {
                        customers = data.customers;
                        products = data.products;
                        
                        localStorage.setItem('customers', JSON.stringify(customers));
                        localStorage.setItem('products', JSON.stringify(products));
                        
                        displayCustomers();
                        displayProducts();
                        updateDashboard();
                        
                        showToast('‡§°‡•á‡§ü‡§æ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§á‡§Æ‡•ç‡§™‡•ã‡§∞‡•ç‡§ü ‡§π‡•Å‡§Ü', 'success');
                    } else {
                        showToast('‡§ó‡§≤‡§§ ‡§´‡§æ‡§á‡§≤ ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü', 'error');
                    }
                } catch (error) {
                    showToast('‡§´‡§æ‡§á‡§≤ ‡§™‡§¢‡§º‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø', 'error');
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        }

        function clearAllData() {
            showConfirmDialog('‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à ‡§∏‡§≠‡•Ä ‡§°‡•á‡§ü‡§æ ‡§∏‡§æ‡§´ ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç? ‡§Ø‡§π ‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§µ‡§æ‡§™‡§∏ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡•Ä ‡§ú‡§æ ‡§∏‡§ï‡§§‡•Ä‡•§', () => {
                customers = [];
                products = [];
                localStorage.removeItem('customers');
                localStorage.removeItem('products');
                
                displayCustomers();
                displayProducts();
                updateDashboard();
                
                showToast('‡§∏‡§≠‡•Ä ‡§°‡•á‡§ü‡§æ ‡§∏‡§æ‡§´ ‡§ï‡§∞ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ', 'success');
            });
        }

        // Utility Functions
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            
            // Reset current references
            if (modalId === 'customerModal') {
                currentCustomer = null;
                clearTransactionForm();
            } else if (modalId === 'productModal') {
                currentProduct = null;
            }
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            container.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => container.removeChild(toast), 400);
            }, 3000);
        }

        function showConfirmDialog(message, onConfirm) {
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmYesBtn').onclick = function() {
                onConfirm();
                closeModal('confirmModal');
            };
            document.getElementById('confirmModal').style.display = 'flex';
        }

        // Master Password Management
        let masterPasswordHash = localStorage.getItem('masterPasswordHash');
        let isWholesalerProtected = localStorage.getItem('isWholesalerProtected') === 'true';

        // Simple hash function for password
        function simpleHash(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convert to 32bit integer
            }
            return hash.toString();
        }

        function updatePasswordStatus() {
            const setupSection = document.getElementById('passwordSetupSection');
            const changeSection = document.getElementById('passwordChangeSection');
            const statusDiv = document.getElementById('passwordStatus');
            const statusText = document.getElementById('passwordStatusText');

            if (masterPasswordHash) {
                setupSection.style.display = 'none';
                changeSection.style.display = 'block';
                statusDiv.style.background = 'linear-gradient(135deg, #27ae60, #2ecc71)';
                statusDiv.style.color = 'white';
                statusText.textContent = 'üîí ‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§π‡•à - ‡§π‡•ã‡§≤‡§∏‡•á‡§≤‡§∞ ‡§ñ‡§æ‡§§‡•á ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§π‡•à‡§Ç';
            } else {
                setupSection.style.display = 'block';
                changeSection.style.display = 'none';
                statusDiv.style.background = 'linear-gradient(135deg, #e74c3c, #c0392b)';
                statusDiv.style.color = 'white';
                statusText.textContent = 'üîì ‡§ï‡•ã‡§à ‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§∏‡•á‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à - ‡§π‡•ã‡§≤‡§∏‡•á‡§≤‡§∞ ‡§ñ‡§æ‡§§‡•á ‡§Ö‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§π‡•à‡§Ç';
            }
        }

        function setMasterPassword() {
            const password = document.getElementById('masterPassword').value.trim();
            const confirmPassword = document.getElementById('confirmPassword').value.trim();

            if (!password) {
                showToast('‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç', 'error');
                return;
            }

            if (password.length < 4) {
                showToast('‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 4 ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§ï‡§æ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showToast('‡§¶‡•ã‡§®‡•ã‡§Ç ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§Æ‡•á‡§≤ ‡§®‡§π‡•Ä‡§Ç ‡§ñ‡§æ‡§§‡•á', 'error');
                return;
            }

            masterPasswordHash = simpleHash(password);
            localStorage.setItem('masterPasswordHash', masterPasswordHash);
            localStorage.setItem('isWholesalerProtected', 'true');
            isWholesalerProtected = true;

            // Clear form
            document.getElementById('masterPassword').value = '';
            document.getElementById('confirmPassword').value = '';

            updatePasswordStatus();
            showToast('‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∏‡•á‡§ü ‡§π‡•ã ‡§ó‡§Ø‡§æ', 'success');
        }

        function changeMasterPassword() {
            const currentPassword = document.getElementById('currentPassword').value.trim();
            const newPassword = document.getElementById('newPassword').value.trim();
            const confirmNewPassword = document.getElementById('confirmNewPassword').value.trim();

            if (!currentPassword || !newPassword || !confirmNewPassword) {
                showToast('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§´‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç', 'error');
                return;
            }

            if (simpleHash(currentPassword) !== masterPasswordHash) {
                showToast('‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§ó‡§≤‡§§ ‡§π‡•à', 'error');
                return;
            }

            if (newPassword.length < 4) {
                showToast('‡§®‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 4 ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§ï‡§æ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è', 'error');
                return;
            }

            if (newPassword !== confirmNewPassword) {
                showToast('‡§®‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§î‡§∞ ‡§ï‡§®‡•ç‡§´‡§∞‡•ç‡§Æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§Æ‡•á‡§≤ ‡§®‡§π‡•Ä‡§Ç ‡§ñ‡§æ‡§§‡•á', 'error');
                return;
            }

            masterPasswordHash = simpleHash(newPassword);
            localStorage.setItem('masterPasswordHash', masterPasswordHash);

            // Clear form
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmNewPassword').value = '';

            showToast('‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§¨‡§¶‡§≤ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ', 'success');
        }

        function removeMasterPassword() {
            const currentPassword = document.getElementById('currentPassword').value.trim();

            if (!currentPassword) {
                showToast('‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç', 'error');
                return;
            }

            if (simpleHash(currentPassword) !== masterPasswordHash) {
                showToast('‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§ó‡§≤‡§§ ‡§π‡•à', 'error');
                return;
            }

            if (confirm('‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à ‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç? ‡§á‡§∏‡§∏‡•á ‡§π‡•ã‡§≤‡§∏‡•á‡§≤‡§∞ ‡§ñ‡§æ‡§§‡•á ‡§Ö‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§π‡•ã ‡§ú‡§æ‡§è‡§Ç‡§ó‡•á‡•§')) {
                localStorage.removeItem('masterPasswordHash');
                localStorage.setItem('isWholesalerProtected', 'false');
                masterPasswordHash = null;
                isWholesalerProtected = false;

                // Clear form
                document.getElementById('currentPassword').value = '';

                updatePasswordStatus();
                showToast('‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§π‡§ü‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ', 'success');
            }
        }

        function checkMasterPassword() {
            if (!masterPasswordHash || !isWholesalerProtected) {
                return true; // No protection set
            }

            const enteredPassword = prompt('‡§π‡•ã‡§≤‡§∏‡•á‡§≤‡§∞ ‡§ñ‡§æ‡§§‡•á ‡§§‡§ï ‡§™‡§π‡•Å‡§Ç‡§ö‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç:');
            
            if (!enteredPassword) {
                showToast('‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡§®‡§æ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•à', 'error');
                return false;
            }

            if (simpleHash(enteredPassword) !== masterPasswordHash) {
                showToast('‡§ó‡§≤‡§§ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°! ‡§™‡§π‡•Å‡§Ç‡§ö ‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§', 'error');
                return false;
            }

            return true;
        }

        // Click outside modal to close
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            displayCustomers();
            displayProducts();
            updateDashboard();
            updatePasswordStatus();
            switchPage('dashboard');
        });
    </script>
</body>
</html>